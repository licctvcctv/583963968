import React from 'react';
import { KaliTerminal } from '../shared/Terminal';

// 七、测试分析
export const MA07_Testing: React.FC = () => {
    return (
        <div className="page bg-white w-[210mm] min-h-[297mm] mx-auto shadow-lg mb-8 p-12 page-break">
            <h2 className="text-[18pt] font-hei mb-6 font-bold">七、测试分析</h2>

            <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">7.1 检测规则测试</h3>
            <p className="mb-4 indent-8 text-justify">
                对编写的Suricata规则进行全面测试，验证检测效果：
            </p>

            <table className="w-full border-collapse border border-gray-400 mb-4">
                <thead>
                    <tr className="bg-gray-100">
                        <th className="border border-gray-400 p-2">测试项</th>
                        <th className="border border-gray-400 p-2">测试数据</th>
                        <th className="border border-gray-400 p-2">预期结果</th>
                        <th className="border border-gray-400 p-2">实际结果</th>
                        <th className="border border-gray-400 p-2">状态</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td className="border border-gray-400 p-2">C2心跳检测</td>
                        <td className="border border-gray-400 p-2">恶意流量PCAP</td>
                        <td className="border border-gray-400 p-2">触发告警</td>
                        <td className="border border-gray-400 p-2">5次告警</td>
                        <td className="border border-gray-400 p-2 text-green-600 font-bold">通过</td>
                    </tr>
                    <tr>
                        <td className="border border-gray-400 p-2">加密流量检测</td>
                        <td className="border border-gray-400 p-2">恶意流量PCAP</td>
                        <td className="border border-gray-400 p-2">触发告警</td>
                        <td className="border border-gray-400 p-2">5次告警</td>
                        <td className="border border-gray-400 p-2 text-green-600 font-bold">通过</td>
                    </tr>
                    <tr>
                        <td className="border border-gray-400 p-2">UA特征检测</td>
                        <td className="border border-gray-400 p-2">恶意流量PCAP</td>
                        <td className="border border-gray-400 p-2">触发告警</td>
                        <td className="border border-gray-400 p-2">5次告警</td>
                        <td className="border border-gray-400 p-2 text-green-600 font-bold">通过</td>
                    </tr>
                    <tr>
                        <td className="border border-gray-400 p-2">正常流量测试</td>
                        <td className="border border-gray-400 p-2">正常HTTP流量</td>
                        <td className="border border-gray-400 p-2">无告警</td>
                        <td className="border border-gray-400 p-2">0次告警</td>
                        <td className="border border-gray-400 p-2 text-green-600 font-bold">通过</td>
                    </tr>
                </tbody>
            </table>
            <p className="text-center text-sm font-bold mb-4">表 7-1 检测规则测试结果</p>

            <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">7.2 解密脚本测试</h3>
            <KaliTerminal 
                cwd="~/malware"
                command="python3 -m pytest test_decrypt.py -v"
                output={`============================= test session starts =============================
collected 4 items

test_decrypt.py::test_valid_decryption PASSED
test_decrypt.py::test_invalid_base64 PASSED
test_decrypt.py::test_wrong_key PASSED
test_decrypt.py::test_json_parsing PASSED

============================= 4 passed in 0.12s ==============================`}
            />
            <p className="text-center text-sm font-bold mb-4">图 7-1 解密脚本测试结果</p>

            <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">7.3 清除脚本测试</h3>
            <p className="mb-4 indent-8 text-justify">
                在受感染的测试虚拟机上运行清除脚本，验证清除效果：
            </p>

            <div className="bg-[#012456] p-4 rounded mb-4 font-mono text-xs text-white">
                <div className="text-gray-300">PS C:\Users\Admin&gt; .\cleanup_malware.ps1</div>
                <div className="text-green-400 mt-1">[*] Malware Cleanup Script</div>
                <div className="text-green-400">[*] Target: UpdateService RAT</div>
                <div className="text-yellow-300 mt-1">[+] Removing registry persistence...</div>
                <div className="text-green-400">[*] Registry key removed: HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\UpdateService</div>
                <div className="text-yellow-300">[+] Removing scheduled task...</div>
                <div className="text-green-400">[*] Scheduled task removed: \Microsoft\Windows\UpdateService\Check</div>
                <div className="text-yellow-300">[+] Removing malicious files...</div>
                <div className="text-green-400">[*] Directory removed: C:\Users\Admin\AppData\Roaming\Microsoft\UpdateService</div>
                <div className="text-yellow-300">[+] Terminating malicious processes...</div>
                <div className="text-green-400">[*] Cleanup completed!</div>
            </div>
            <p className="text-center text-sm font-bold mb-4">图 7-2 清除脚本执行结果</p>

            <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">7.4 调试过程中的问题</h3>
            <table className="w-full border-collapse border border-gray-400 mb-4">
                <thead>
                    <tr className="bg-gray-100">
                        <th className="border border-gray-400 p-2">问题描述</th>
                        <th className="border border-gray-400 p-2">原因分析</th>
                        <th className="border border-gray-400 p-2">解决方案</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td className="border border-gray-400 p-2">解密结果乱码</td>
                        <td className="border border-gray-400 p-2">IV值提取错误</td>
                        <td className="border border-gray-400 p-2">重新逆向分析确认IV</td>
                    </tr>
                    <tr>
                        <td className="border border-gray-400 p-2">Suricata规则误报</td>
                        <td className="border border-gray-400 p-2">正则表达式过于宽泛</td>
                        <td className="border border-gray-400 p-2">添加更多特征约束</td>
                    </tr>
                    <tr>
                        <td className="border border-gray-400 p-2">样本无法运行</td>
                        <td className="border border-gray-400 p-2">缺少运行时依赖</td>
                        <td className="border border-gray-400 p-2">安装Wine和依赖库</td>
                    </tr>
                </tbody>
            </table>
            <p className="text-center text-sm font-bold mb-4">表 7-2 调试问题及解决方案</p>
        </div>
    );
};
